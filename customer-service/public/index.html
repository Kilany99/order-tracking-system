<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Tracking</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Order Form -->
        <h2>Place Order</h2>
        <form id="orderForm">
            <div class="form-group">
                <label>Customer ID:</label>
                <input type="text" id="customerId" required>
            </div>
            <div class="form-group">
                <label>Delivery Address:</label>
                <input type="text" id="deliveryAddress" required>
            </div>
            <div class="form-group">
                <label>Latitude:</label>
                <input type="number" id="deliveryLatitude" step="any" required>
            </div>
            <div class="form-group">
                <label>Longitude:</label>
                <input type="number" id="deliveryLongitude" step="any" required>
            </div>
            <button type="submit">Place Order</button>
        </form>

        <!-- Order Tracking -->
        <h2>Track Order</h2>
        <div class="form-group">
            <input type="text" id="orderId" placeholder="Enter Order ID">
            <button onclick="trackOrder()">Track</button>
        </div>

        <!-- Order Status Display -->
        <div id="orderStatus" class="order-status"></div>
    </div>

    <script>
        // Submit order form
        $("#orderForm").submit(function(e) {
            e.preventDefault();
            placeOrder();
        });

        // Place order via Order Service API
        function placeOrder() {
            const orderData = {
                customerId: $("#customerId").val(),
                deliveryAddress: $("#deliveryAddress").val(),
                deliveryLatitude: parseFloat($("#deliveryLatitude").val()),
                deliveryLongitude: parseFloat($("#deliveryLongitude").val())
            };

            $.ajax({
                url: "https://192.168.43.144:45456/api/orders",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(orderData),
                success: function(response) {
                    alert(`Order placed! ID: ${response}`);
                },
                error: function(xhr) {
                    alert("Error: " + xhr.responseJSON?.error || "Failed to place order.");
                }
            });
        }

        // Track order status
        function trackOrder() {
            const orderId = $("#orderId").val();
            $.ajax({
                url: `https://192.168.43.144:45456/api/orders/${orderId}`,
                type: "GET",
                success: function(order) {
                    let statusMessage = '';

                    // Using switch-case for order status
                    switch (order.status) {
                        case 0:
                            statusMessage = "<p><strong>Status:</strong> Order has been created and is being processed.</p>";
                            break;
                        case 1:
                            statusMessage = "<p><strong>Status:</strong> Order is being prepared.</p>";
                            break;
                        case 2:
                            statusMessage = "<p><strong>Status:</strong> Order is out for delivery.</p>";
                            break;
                        case 3:
                            statusMessage = "<p><strong>Status:</strong> Order has been delivered.</p>";
                            break;
                        default:
                            statusMessage = "<p><strong>Status:</strong> Unknown status.</p>";
                            break;
                    }

                    // Update UI with the status and other information
                    $("#orderStatus").html(`
                        ${statusMessage}
                        <p><strong>Address:</strong> ${order.deliveryAddress}</p>
                        <p><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
                    `);
                },
                error: function(xhr) {
                    $("#orderStatus").html("<p>Order not found.</p>");
                }
            });
        }
    </script>
</body>
</html>
